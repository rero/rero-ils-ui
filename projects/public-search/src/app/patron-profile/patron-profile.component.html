<!--
  RERO ILS UI
  Copyright (C) 2021-2024 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ngx-loading-bar [includeSpinner]="false" height="3px"></ngx-loading-bar>
@if (user) { @if (user.isAuthenticated && user.isPatron) {
<header>
  <h3>{{ fullname }}</h3>
</header>
<section class="mt-2">
  <public-search-patron-profile-menu
    patronPid="{{ patron.pid }}"
  ></public-search-patron-profile-menu>
</section>
<section class="mt-3">
  <public-search-patron-profile-message></public-search-patron-profile-message>
</section>
@for (tab of tabs|keyvalue: sortTabs; track tab) {
  {{tab.key}}
}
<section class="mt-3">
  <p-tabView (onChange)="tabOnChange($event)">

@for (tab of tabs|keyvalue: sortTabs; track tab.key) {
  <p-tabPanel>
    <ng-template pTemplate="header">
    {{tab.value.title}}
    @if (tab.value.count != null) {
        <p-badge class="ml-1" [value]="tab.value.count" severity="info"/>
    }
    @if (tab.value.feeTotal != null) {
        <p-badge class="ml-1" [value]="tab.value.feeTotal  | currency : patron.organisation.currency : 'symbol'" severity="warning"/>
    }
  </ng-template>
  @switch(tab.key) {
    @case ('loan') {
      <public-search-patron-profile-loans [count]="tab.value.count" />
    }
    @case ('request') {
      <public-search-patron-profile-requests />
    }
    @case ('fee') {
      <public-search-patron-profile-fees [feesTotal]="tab.value.feeTotal" />
    }
    @case ('history') {
      <public-search-patron-profile-histories />
    }
    @case ('illRequest') {
      <public-search-patron-profile-ill-requests />
    }
    @case ('personalDetails') {
      <public-search-patron-profile-personal
        [user]="user"
        [patron]="patron"
        [viewcode]="viewcode"
      />
    }
  }
  </p-tabPanel>
}
  </p-tabView>
</section>
} @else {
<div class="text-center">
  <h3 class="mt-4 mb-4" translate>Access denied</h3>
  {{ "You are not identified as a patron." | translate }}
</div>
} }
