<!--
 RERO ILS UI
  Copyright (C) 2020-2024 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<section class="content">
  <p-tabView (onChange)="tabChange($event)">
    <p-tabPanel>
      <ng-template pTemplate="header">
        <span translate>Engaged fees</span>
        @if (statistics()['fees'] > 0) {
          <p-tag severity="warning" class="ml-2">
            {{ statistics()['fees'] | currency: organisation.default_currency }}
          </p-tag>
        }
      </ng-template>
      <div class="text-right my-2">
        <p-button
          icon="fa fa-plus"
          [label]="'Add a fee'|translate"
          (onClick)="addFee()"
        />
      </div>
      @if (tabs.engagedFees.transactions.length > 0) {
        <div class="row mb-1 d-flex align-items-center bg-dark text-white rounded">
          <div class="col-2 pl-20" translate>Date</div>
          <div class="col-4" translate>Category</div>
          <div class="col-3" translate>Library</div>
          <div class="col-2 text-right">
            {{ 'Total amount' | translate }}: {{ statistics()['fees'] | currency: organisation.default_currency }}
          </div>
          <div class="col-1 pl-0">
            <p-splitButton
              [label]="'Pay all'|translate"
              [disabled]="tabs.engagedFees.totalAmount <= 0"
              [model]="actions"
              (onClick)="payAllTransactions()"
            />
          </div>
        </div>
        @for (t of tabs.engagedFees.transactions; track t) {
          <admin-patron-transaction [transaction]="t" class="row mb-1" />
        }
      } @else {
        {{ 'No pending fee for this patron' | translate }}
      }
    </p-tabPanel>

    <p-tabPanel>
      <ng-template pTemplate="header">
        <span translate>Overdue preview fees</span>
        @if (tabs.overduePreviewFees.totalAmount > 0) {
          <p-tag severity="secondary" class="ml-2">
            {{ tabs.overduePreviewFees.totalAmount | currency: organisation.default_currency }}
          </p-tag>
        }
      </ng-template>
      @if (tabs.overduePreviewFees.transactions.length > 0) {
        <div class="row mb-1 d-flex align-items-center bg-dark text-white rounded">
          <div class="col-2 pl-20 my-2" translate>Due date</div>
          <div class="col-7" translate>Document</div>
          <div class="col-2 text-right">
            {{ 'Total amount' | translate }}: {{ tabs.overduePreviewFees.totalAmount | currency: organisation.default_currency }}
          </div>
          <div class="col-1"></div>
        </div>
        @for (t of tabs.overduePreviewFees.transactions; track t) {
          <admin-overdue-transaction [transaction]="t" class="row mb-1" />
        }
      } @else {
        {{ 'No overdue fees for this patron' | translate }}
      }
    </p-tabPanel>

    <p-tabPanel>
      <ng-template pTemplate="header">
        <span translate>History</span>
      </ng-template>
      @if (tabs.historyFees.transactions !== null && tabs.historyFees.transactions.length > 0) {
        <div class="row mb-1 d-flex align-items-center bg-dark text-white rounded">
          <div class="col-2 pl-20 my-2" translate>Date</div>
          <div class="col-4" translate>Category</div>
          <div class="col-5" translate>Library</div>
        </div>
        @for (t of tabs.historyFees.transactions; track t) {
          <admin-patron-transaction class="row mb-1 align-items-start" [transaction]="t" />
        }
      } @else {
        {{ 'No fee history for this patron' | translate }}
      }
    </p-tabPanel>
  </p-tabView>
</section>
