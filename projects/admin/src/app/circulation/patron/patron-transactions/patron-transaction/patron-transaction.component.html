<!--
  RERO ILS UI
  Copyright (C) 2021-2024 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
@if (transaction !== undefined) {
  <div [ngClass]="{ 'callout callout-warning': isDisputed(), 'border rounded': !isDisputed()}" class="col mr-1 p-2">
    <div class="row">
      <div class="col-lg-2">
        <shared-open-close-button (status)="isCollapsed = $event" />
        {{ transaction.creation_date | dateTranslate :'shortDate' }}
      </div>
      <div class="col-lg-4 d-inline-block text-truncate">{{ transaction.type | translate }}</div>
      <div class="col-lg-3 d-inline-block text-truncate">
        @if (transaction.library) {
          <span>{{ transaction.library.pid | getRecord: 'libraries' : 'field' : 'name' | async }}</span>
        }
      </div>
      <div class="col-lg-2 text-lg-right">{{ transactionAmount | currency: organisation.default_currency }}</div>
      <div class="col-md-1 text-left pl-0 mb-2" dropdown>
        @if (transaction.status === patronTransactionStatus.OPEN) {
          <p-dropdown
            [placeholder]="'Action'|translate"
            [options]="menuItems"
            [(ngModel)]="menuSelectedAction"
            (onChange)="patronTransactionEvent($event)"
          />
        }
      </div>
    </div>
    @if (!isCollapsed) {
      <div class="mt-2">
        <!-- Transaction detail -->
        <h6 translate>Details</h6>
        <section class="offset-md-1 mb-3" [ngSwitch]="transaction?.type">
          <admin-overdue-transaction-detail [transaction]="transaction" *ngSwitchCase="'overdue'" />
          <admin-default-transaction-detail [transaction]="transaction" *ngSwitchDefault />
        </section>
        <!-- Transaction history -->
        <h6 translate>Transaction history</h6>
        <div class="events-timeline">
          @for (event of transaction.get_events(); track event) {
            <admin-patron-transaction-event [event]="event" class="row pl-2 pr-2 align-items-start timeline-event" />
          }
        </div>
      </div>
    }
  </div>
}

