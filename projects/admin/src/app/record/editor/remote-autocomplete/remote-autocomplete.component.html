<!--
  RERO ILS UI
   Copyright (C) 2019 RERO
  
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU Affero General Public License as published by
   the Free Software Foundation, version 3 of the License.
  
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
   GNU Affero General Public License for more details.
  
   You should have received a copy of the GNU Affero General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<div class="input-group" [formGroup]="formGroup">
  <input
    autocomplete="off"
    [type]="type"
    [formControl]="formControl"
    class="form-control"
    [formlyAttributes]="field"
    [class.is-invalid]="showError"

    formControlName="name"
    [typeaheadAsync]="true"
    [typeahead]="dataSource"
    (typeaheadLoading)="changeTypeaheadLoading($event)"
    (typeaheadOnSelect)="typeaheadOnSelect($event)"
    [typeaheadWaitMs]="300"
    [typeaheadMinLength]="0"
    [typeaheadItemTemplate]="customItemTemplate"
    [typeaheadOptionsLimit]="numberOfSuggestions"
    typeaheadGroupField="category"
    typeaheadOptionField="name"
    placeholder="Locations loaded with timeout"
    class="form-control"
  />
  <div class="input-group-append">
    <span class="input-group-text" id="{field.id}-search">
      <i *ngIf="!typeaheadLoading" class="fa fa-search"></i>
      <i *ngIf="typeaheadLoading" class="fa fa-spinner fa-spin"></i>
    </span>
  </div>
</div>

<ng-template
  #customItemTemplate
  let-match="match"
  let-query="query"
  let-model="item"
  let-index="index"
>
  <span [innerHtml]="model.name"></span>
</ng-template>
