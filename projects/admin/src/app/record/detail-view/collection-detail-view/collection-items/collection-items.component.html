<!--
  RERO ILS UI
  Copyright (C) 2020-2025 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
@if (items) {
  <h4 translate>Items</h4>
  <ul class="ui:list-none">
    @for (item of items; track item.pid) {
      @let itemData = item.pid | getRecord: 'items' | async;
      @if (itemData) {
        <li class="ui:p-2 ui:odd:bg-surface-50 ui:flex ui:gap-6">
          @if ($any(itemData).metadata.document.pid | getRecord:'documents':'object':null:{Accept: 'application/rero+json'} | async; as document) {
            <div class="ui:hidden ui:sm:block">
              <shared-thumbnail [record]="document" />
            </div>
            <div class="ui:grow">
              <h5>
                <a [routerLink]="['/records','documents', 'detail', $any(itemData).metadata.document.pid]">
                  {{ $any(document).metadata.title[0]._text }}
                </a>
              </h5>
              <div>
                @if ($any(document).metadata.contribution) {
                  <shared-contribution [contributions]="$any(document).metadata.contribution"></shared-contribution>
                }
                @let provisionActivity = $any(document).metadata.provisionActivity
                | documentProvisionActivity
                | keyvalue
                | callbackArrayFilter
                  : filterPublicationProvisionActivity;
                @for (provision of provisionActivity; track $index) {
                    <ul class="ui:list-none">
                      @for (value of $any(provision).value; track $index) {
                        <li>{{ value }}</li>
                      }
                    </ul>
                }
              </div>
              <dl class="metadata ui:mt-2">
                <dt translate>Barcode</dt>
                <dd>
                  <a [routerLink]="['/records','items','detail', item.pid]">{{ $any(itemData).metadata.barcode }}</a>
                </dd>
                @if (itemData | itemHoldingsCallNumber | async; as callNumber) {
                  @if ((callNumber.first | json) !== '{}' || (callNumber.second | json) !== '{}') {
                    <dt translate>Call number</dt>
                    <dd>
                      <shared-inherited-call-number [item]="itemData" />
                    </dd>
                  }
                }
                @if ($any(itemData).metadata.location.pid | getRecord:'locations' | async; as location) {
                  <dt translate>Library</dt>
                  <dd>
                    @if ($any(location).metadata.library.pid | getRecord: 'libraries' | async; as library) {
                      {{ $any(library).metadata.name }} - {{ $any(location).metadata.name }}
                    }
                  </dd>
                }
              </dl>
            </div>
          }
        </li>
      }
    }
  </ul>
}
