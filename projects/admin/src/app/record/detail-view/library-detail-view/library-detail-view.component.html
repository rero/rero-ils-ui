<!--
  RERO ILS UI
  Copyright (C) 2019 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ng-container *ngIf="record">
  <section id="library-profile" class="container-fluid card p-0 my-3">
    <div class="card-body row">
      <div class="col-2">
        <div class="library-logo">
          <!-- TODO :: add a field to store the library logo url and display it here ? -->
          <i class="fa fa-university fa-4x text-white"></i>
        </div>
      </div>
      <div class="col">
        <h1>{{ record.name }}</h1>
        <dl class="row library-metadata">
          <dt class="metadata-code offset-1 col-3" translate>Code</dt>
          <dd class="col-8">{{ record.code }}</dd>
          <ng-container *ngIf="record.email">
            <dt class="metadata-email offset-1 col-3" translate>Email</dt>
            <dd class="col-8">{{ record.email }}</dd>
          </ng-container>
          <ng-container *ngIf="record.address">
            <dt class="metadata-address offset-1 col-3" translate>Address</dt>
            <dd class="col-8">{{ record.address }}</dd>
          </ng-container>
          <dt class="metadata-language offset-1 col-3" translate>Language</dt>
          <dd class="col-8">{{ ('lang_' + record.communication_language) | translate | ucfirst }}</dd>
        </dl>
      </div>
    </div>
  </section>

  <tabset>
    <tab><!-- OPENING HOURS TABS -->
      <ng-template tabHeading>
        <i class="far fa-clock mr-2"></i>{{ 'Opening Hours' | translate }}
      </ng-template>
      <admin-day-opening-hours [day]="day" *ngFor="let day of record.opening_hours"></admin-day-opening-hours>
    </tab>
    <tab><!-- EXCEPTIONS DATES -->
      <ng-template tabHeading>
        <i class="fa fa-exclamation-triangle mr-2"></i>{{ 'Exceptions (holidays, etc.)' | translate }}
      </ng-template>
      <ng-container *ngIf="record.exception_dates">
        <admin-exception-date [exception]="exception" *ngFor="let exception of record.exception_dates"></admin-exception-date>
      </ng-container>
    </tab>
    <tab><!-- NOTIFICATIONS SETTINGS -->
      <ng-template tabHeading>
        <i class="far fa-envelope mr-2"></i>{{ 'Notification settings' | translate }}
      </ng-template>
      <dl class="row" *ngIf="record.notification_settings as notificationSettings">
        <ng-container *ngFor="let setting of notificationSettings">
          <dt class="col-3">{{ setting.type | translate | ucfirst }}:</dt>
          <dd class="col-7">
            {{ setting.email }}
            <ng-container *ngIf="setting.delay">
              ; {{ 'Delay' | translate }}: {{ setting.delay }}
              {{ setting.delay > 1 ? ('minutes' | translate) : ('minute' | translate) }}
            </ng-container>
          </dd>
        </ng-container>
      </dl>
    </tab>
    <tab> <!-- ACQUISITION SETTINGS -->
      <ng-template tabHeading>
        <i class="fa fa-university mr-2"></i>{{ 'Acquisition settings' | translate }}
      </ng-template>
      <dl class="row" *ngIf="record.acquisition_settings as acquisitionSettings">
        <ng-container *ngIf="acquisitionSettings.shipping_informations as acqInfos"
                      [ngTemplateOutlet]="address_block"
                      [ngTemplateOutletContext]="{ label: 'Shipping informations' | translate, data: acqInfos}"
        ></ng-container>
        <ng-container *ngIf="acquisitionSettings.billing_informations as acqInfos"
                      [ngTemplateOutlet]="address_block"
                      [ngTemplateOutletContext]="{ label: 'Billing informations' | translate, data: acqInfos}"
        ></ng-container>
      </dl>
    </tab>
  </tabset>

  <!-- LOCATIONS -->
  <div class="card mt-4">
    <div class="card-header">
      <b translate>Locations</b>
      <a class="ml-2 btn btn-sm btn-outline-primary float-right" *ngIf="isUserCanAddLocation"
        [routerLink]="['/', 'records', 'locations', 'new']" [queryParams]="{ library: record.pid }">
        <i class="far fa-square-plus"></i> {{ 'Add' | translate }} &hellip;
      </a>
    </div>
    <div class="card-body collapsed show">
      <ul class="list-group list-group-flush" *ngIf="locations; else no_locations">
        <li *ngFor="let location of locations" class="list-group-item p-1">
          <admin-location
            [location]="location"
            [library]="record" class="row"
            (deleteLocation)="deleteLocation($event)"
          ></admin-location>
        </li>
      </ul>
      <ng-template #no_locations>
        <p translate>no location</p>
      </ng-template>
    </div>
  </div>
</ng-container>


<ng-template #address_block let-label="label" let-data="data">
  <dt class="col-3 label-title">{{ label }}</dt>
  <div class="col-9 card container py-2 mb-2">
    <div class="row">
      <div class="col-6 d-flex">
        <i class="far fa-address-card pr-2 pt-1"></i>
        <div>
          {{ data.name }}<br/>
          <ng-container *ngIf="data.address">
            <ng-container *ngIf="data.address.street">{{ data.address.street }}<br/></ng-container>
            <ng-container *ngIf="data.address.zip_code || data.address.city">
              <span *ngIf="data.address.zip_code">{{ data.address.zip_code }}</span>
              <span *ngIf="data.address.zip_code && data.address.city"> - </span>
              <span *ngIf="data.address.city">{{ data.address.city }}</span><br/>
            </ng-container>
            <ng-container *ngIf="data.address.country">{{ data.address.country | countryCodeTranslate }}</ng-container>
          </ng-container>
        </div>
      </div>
      <div class="col-6">
        <dd *ngIf="data.email"><i class="fa fa-at pr-2"></i>{{ data.email }}</dd>
        <dd *ngIf="data.phone"><i class="fa fa-phone-square pr-2"></i>{{ data.phone }}</dd>
        <dd *ngIf="data.extra"><i class="far fa-note-sticky pr-2"></i>{{ data.extra }}</dd>
      </div>
    </div>
  </div>
</ng-template>
