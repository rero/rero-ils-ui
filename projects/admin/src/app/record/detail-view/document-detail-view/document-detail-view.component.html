<!--
  RERO ILS UI
  Copyright (C) 2019-2024 RERO
  Copyright (C) 2019-2023 UCLouvain

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
@if (record) {
<!-- HEADER -->
<header class="grid mt-5 mb-3">
  <div class="col-2 text-center">
    <shared-thumbnail [record]="record"></shared-thumbnail>
  </div>
  <div class="col-10">
    <!-- ADMIN METADATA -->
    @if (recordMessage.length > 0) {
    <p-messages
      [value]="recordMessage"
      [enableService]="false"
      [closable]="false"
      showTransitionOptions="0ms"
    />
    }

    <!-- TITLE -->
    @if (record.metadata.title && record.metadata.title | mainTitle; as title) {
    <h2 id="doc-title" class="pl-0 mt-1">
      <ng-core-text-read-more
        [text]="title"
        [unit]="'character'"
        [limit]="150"
        [showMoreLabel]="'Show more' | translate"
        [showLessLabel]="'Show less' | translate"
      ></ng-core-text-read-more>
    </h2>
    }

    <!-- TITLE ALTERNATIVE GRAPHICS -->
    @if (record.metadata.ui_title_altgr) { @for (altgr_title of
    record.metadata.ui_title_altgr; track altgr_title; let i = $index) {
    <h3 id="{{ 'doc-altgr-title-' + i }}">{{ altgr_title }}</h3>
    } }

    <!-- CONTRIBUTION -->
    <shared-contribution
      [contributions]="record.metadata?.contribution"
      [withRoles]="true"
      [activateLink]="activateLink"
    >
    </shared-contribution>
    <!-- PUBLICATION ACTIVITY: PUBLICATION -->
    <ng-container
      *ngVar="
        record.metadata.provisionActivity
          | documentProvisionActivity
          | keyvalue
          | callbackArrayFilter
            : filterPublicationProvisionActivity as provisionActivity
      "
    >
      @for (provision of provisionActivity; track provision) {
      <ul class="list-unstyled mb-0">
        @for (value of $any(provision).value; track value) {
        <li>{{ value }}</li>
        }
      </ul>
      }
    </ng-container>

    <!-- EXTENT-->
    @if (record.metadata.extent) {
    <div id="doc-extent">
      {{ record.metadata.extent }}
    </div>
    }

    <!-- DURATION -->
    @if (record.metadata.duration && record.metadata.duration.length > 0) {
    <div id="doc-duration">
      {{ "Duration" | translate }}: {{ record.metadata.duration.join(", ") }}
    </div>
    }

    <!-- EDITION STATEMENT -->
    @if (record.metadata.editionStatement) {
    <div id="doc-edition-statement">
      <ul class="list-unstyled mb-0">
        @for (edition of record.metadata.editionStatement; track edition) {
        <li>{{ edition._text[0].value }}</li>
        }
      </ul>
    </div>
    }

    <!-- FREQUENCY -->
    @if (record.metadata.frequency) {
    <div id="doc-frequency">
      <b>{{ "Frequency" | translate }}</b
      >: @for (freq of record.metadata.frequency; track freq; let isLast =
      $last) {
      {{ freq.label }}
      @if (freq.date) { ({{ freq.date }}) @if (!isLast) {; } } }
    </div>
    }

    <!-- IS PART OF -->
    <shared-part-of [record]="record"></shared-part-of>

    <!-- ISSUED WITH -->
    @if (record.metadata.issuedWith) {
    <admin-other-edition
      fieldLabel="{{ 'Issued with' | translate }}"
      [field]="record.metadata.issuedWith"
      [header]="true"
    ></admin-other-edition>
    }

    <!-- PRECEDED BY -->
    @if (record.metadata.precededBy) {
    <admin-other-edition
      fieldLabel="{{ 'Preceded by' | translate }}"
      [field]="record.metadata.precededBy"
      [header]="true"
    ></admin-other-edition>
    }

    <!-- SUCCEEDED BY -->
    @if (record.metadata.succeededBy) {
    <admin-other-edition
      fieldLabel="{{ 'Succeeded by' | translate }}"
      [field]="record.metadata.succeededBy"
      [header]="true"
    ></admin-other-edition>
    }

    <!-- SUPPLEMENT TO -->
    @if (record.metadata.supplementTo) {
    <admin-other-edition
      fieldLabel="{{ 'Supplement to' | translate }}"
      [field]="record.metadata.supplementTo"
      [header]="true"
    ></admin-other-edition>
    }

    <!-- REPRODUCTION OF -->
    @if (record.metadata.reproductionOf) {
    <admin-other-edition
      fieldLabel="{{ 'Reproduction of' | translate }}"
      [field]="record.metadata.reproductionOf"
      [header]="true"
    ></admin-other-edition>
    }

    <!-- ELECTRONIC LOCATOR: RELATED RESOURCE -->
    @if (relatedResources.length > 0) {
    <div class="row">
      <div class="col">
        <ul class="list-unstyled mt-1 mb-0">
          @for (eloc of relatedResources; track eloc) {
          <li>
            <admin-related-resource
              [electronicLocator]="eloc"
            ></admin-related-resource>
          </li>
          }
        </ul>
      </div>
    </div>
    }

    <!-- SUMMARY -->
    @if (record.metadata.summary) { @for (sum of record.metadata.summary; track
    sum) { @for (data of sum.label; track data) {
    <div>
      <ng-core-text-read-more
        [text]="data.value"
        [unit]="'character'"
        [limit]="400"
        [showMoreLabel]="'Show more' | translate"
        [showLessLabel]="'Show less' | translate"
      ></ng-core-text-read-more>
    </div>
    } } }

    <!-- SUBJECTS -->
    @if (record.metadata.subjects; as subjects) {
    <div class="row">
      <div class="col">
        @for (subject of subjects; track subject) {
        <span
          class="badge badge-secondary mr-1"
          title="{{ subject.entity.type | translate }}"
        >
          <i class="fa fa-tag mr-1"></i>
          <shared-entity-link
            resourceName="subjects"
            [entity]="subject.entity"
            className="text-light"
          ></shared-entity-link>
        </span>
        }
      </div>
    </div>
    }

    <!-- GENRE, FORM -->
    @if (record.metadata.genreForm) {
    <div class="mt-1">
      @for (genre of record.metadata.genreForm; track genre) {
      <span class="mr-1">
        <i class="fa fa-tag mr-1"></i>
        <shared-entity-link
          resourceName="genreForm"
          [entity]="genre.entity"
        ></shared-entity-link>
      </span>
      }
    </div>
    }

    <!-- MASKED -->
    @if (record.metadata._masked) {
    <admin-record-masked
      [record]="record"
      [withLabel]="true"
    ></admin-record-masked>
    }

    <!-- LINKED DOCUMENTS -->
    @if (linkedDocumentsCount) {
    <a
      class="btn btn-sm btn-outline-primary mt-3"
      [routerLink]="['/records', 'documents']"
      [queryParams]="{ q: 'partOf.document.pid:' + pid, simple: 0 }"
    >
      <i class="fa fa-list" aria-hidden="true"></i>
      {{ linkedDocumentsCount }}
      {{
        linkedDocumentsCount
          | i18nPlural : { "=1": "article/volume", other: "articles/volumes" }
          | translate
      }}
    </a>
    }
  </div>
</header>
<!-- END OF HEADER -->

<!-- TABS -->
<p-tabView>
  <!-- GET TAB -->
  @if (record.metadata.pid) {
    <p-tabPanel>
      <ng-template pTemplate="header">
        <i class="fa fa-list-ul mr-1"></i> {{ "Get" | translate }}
      </ng-template>
      <div class="mb-2">
        <shared-doc-files [documentPid]="record.metadata.pid" />
      </div>
      <admin-holding-organisation [document]="record" />
    </p-tabPanel>
  }

  <!-- DESCRIPTION TAB -->
  <p-tabPanel>
    <ng-template pTemplate="header">
      <i class="fa fa-bars mr-1"></i> {{ "Description" | translate }}
    </ng-template>
    <admin-document-description [record]="record" />
  </p-tabPanel>

  <!-- ENTITIES RELATED -->
  @if (!record.metadata.harvested && record.metadata.pid) {
    <p-tabPanel>
      <ng-template pTemplate="header">
        <i class="fa fa-cubes mr-1"></i> {{ "Related Entities" | translate }}
      </ng-template>
      <admin-entities-related [record]="record" />
    </p-tabPanel>
  }

  <!-- LOCAL FIELDS TAB -->
  @if (!record.metadata.harvested && record.metadata.pid && showLocalFieldsTab) {
    <p-tabPanel>
      <ng-template pTemplate="header">
        <i class="fa fa-list-ul mr-1"></i> {{ "Local fields" | translate }}
      </ng-template>
      <admin-local-field [resourceType]="'documents'" [resourcePid]="record.metadata.pid" />
    </p-tabPanel>
  }

  <!-- FILES TAB -->
  @if (!record.metadata.harvested && record.metadata.pid && showFilesTab) {
    <p-tabPanel>
      <ng-template pTemplate="header">
        <i class="fa fa-file mr-1"></i> {{ "Files" | translate }}
      </ng-template>
      <admin-upload-files [pid]="record.metadata.pid" />
    </p-tabPanel>
  }

  <!-- MARC TAB -->
  @if (marc$ | async; as marc) {
    <p-tabPanel>
      <ng-template pTemplate="header">
        <i class="fa fa-list-ul mr-1"></i><span translate>Marc</span>
      </ng-template>
      <p-table [value]="marc" styleClass="p-datatable-striped">
        <ng-template pTemplate="body" let-field>
          <tr>
            @if (field | marc; as f) {
              <td class="font-bold">{{ f.field }}</td>
              <td>{{ f.ind1 }}</td>
              <td>{{ f.ind2 }}</td>
              <td>{{ f.value }}</td>
            }
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>
  }
</p-tabView>
}
