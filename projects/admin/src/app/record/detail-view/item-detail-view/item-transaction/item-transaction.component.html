<!--
  RERO ILS UI
  Copyright (C) 2019 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<ng-container *ngIf="transaction">
  <div class="row mb-2">
    <ng-container *ngIf="transaction.metadata.patron_pid | getRecord:'patrons' | async as patron">
      <div class="col-4">
        <a [routerLink]="['/circulation', 'patron', patron.metadata.barcode]">
          {{ patron.metadata.last_name }} {{ patron.metadata.first_name }} ({{ patron.metadata.barcode }})
        </a>
      </div>
      <!-- LOANS (BORROW) -->
      <ng-container *ngIf="type === 'loan_borrow'">
        <div class="col-4">
          {{ transaction.metadata.extension_count ?  transaction.metadata.extension_count : '-' }}
        </div>
        <div class="col-3">
          {{ transaction.metadata.end_date | dateTranslate:'longDate' }}
        </div>
      </ng-container>
      <!-- REQUESTS -->
      <ng-container *ngIf="type === 'loan_request'">
        <ng-container *ngIf="canUpdateRequestPickupLocation(); else pickupLocationName">
          <select class="custom-select col-4">
            <ng-container *ngFor="let pickup of pickupLocations">
              <ng-container *ngIf="pickup.value === transaction.metadata.pickup_location_pid; else otherLocationsBlock">
                <option selected>{{ pickup.label }}</option>
              </ng-container>
              <ng-template #otherLocationsBlock>
                <option (click)="updateRequest(pickup.value)">{{ pickup.label }}</option>
              </ng-template>
            </ng-container>
          </select>
        </ng-container>
        <ng-template #pickupLocationName>
          <div class="col-4">
            {{ transaction.metadata.pickup_location_pid | getRecord:'locations':'field':'pickup_name' | async }}
          </div>
        </ng-template>
        <div class="col-3">
          {{ transaction.metadata.transaction_date | dateTranslate:'longDate' }}
        </div>
        <div class="col-1">
          <ng-container *ngIf="canCancelRequest(); else noCancel">
            <button
            type="button"
            class="btn btn-danger btn-sm"
            (click)="showCancelRequestDialog()"
          ><i class="fa fa-trash-o" aria-hidden="true"></i></button>
          </ng-container>
          <ng-template #noCancel>
            <button
            type="button"
            class="btn btn-danger btn-sm"
            disabled
          ><i class="fa fa-trash-o" aria-hidden="true"></i></button>
          </ng-template>
        </div>
      </ng-container>
    </ng-container>
  </div>
</ng-container>
