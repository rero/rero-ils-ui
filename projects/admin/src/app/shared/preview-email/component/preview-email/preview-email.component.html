<!--
  RERO ILS UI
  Copyright (C) 2023-2024 RERO
  Copyright (C) 2023 UCLouvain

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<div class="flex flex-column gap-2">
  <!-- PREVIEW TOP -->
  <ng-content select="[headerMessage]" />
  @if (previewPosition === 'top') {
    <div>
      <h5 translate>Message</h5>
      <ng-content select="[previewMessage]" />
      <pre [innerHTML]="preview.trim() | nl2br"></pre>
    </div>
  }

  <h5 translate>Who do you want to send the message to?</h5>

  <!-- SUGGESTED EMAILS -->
  @if (emails.length > 0) {
    <p-panel>
      <ng-template pTemplate="header">
        <div class="p-panel-title">
        @if (emails.length < 2) {
          {{ 'Suggested email address' | translate }}
        } @else {
          {{ 'Suggested email addresses' | translate }}
        }
        <small class="ml-1">(<span class="font-italic" translate>Drag and drop</span>)</small>
      </div>
      </ng-template>
      <div class="flex gap-1">
        @for (email of emails; track email) {
            <p-tag pDraggable="emails" [style]="{cursor: 'grab'}" (onDragStart)="dragStart(email)" (onDragEnd)="dragEnd()" icon="pi pi-user" [value]="email"></p-tag>
        }
      </div>
    </p-panel>
  }

  <!-- RECIPIENTS -->
  <p-panel [header]="'Recipients' | translate">
    <div class="grid">
      @for (type of emailTypes; track type) {
        <div class="col-2" [class.field-required]="mandatoryEmailTypes.includes(type)">
          {{ ('email_' + type) | translate }}&nbsp;:
        </div>
        <div class="col-10">
          <p-chips class="p-fluid" [inputId]="type" pDroppable="emails" (onDrop)="drop($event)" [(ngModel)]="recipients[type]" [addOnBlur]="true" />
        </div>
      }
    </div>
  </p-panel>

  <!-- PREVIEW BOTTOM -->
  @if (previewPosition === 'bottom') {
    <div>
      <h5 translate>Message</h5>
      <ng-content select="[previewBottomMessage]" />
      <pre class="max-h-25rem border-1 border-round text-sm surface-100 surface-border overflow-auto p-4 "[innerHTML]="preview.trim() | nl2br"></pre>
    </div>
  }
</div>
<div class="flex justify-content-end">
  <p-button class="mr-1" severity="danger" outlined [label]="'Cancel'|translate" (onClick)="close()" aria-label="Close"/>
  <p-button [label]="'Confirm'|translate" [disabled]="!formValid()" (onClick)="confirm()" />
</div>
