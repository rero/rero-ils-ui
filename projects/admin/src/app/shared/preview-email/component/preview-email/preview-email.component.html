<!--
  RERO ILS UI
  Copyright (C) 2023-2024 RERO
  Copyright (C) 2023 UCLouvain

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<div>
  <!-- PREVIEW TOP -->
  <ng-content select="[headerMessage]"></ng-content>
  @if (previewPosition === 'top') {
    <h5 translate>Message</h5>
    <ng-content select="[previewMessage]"></ng-content>
    <pre [innerHTML]="preview.trim() | nl2br"></pre>
  }

  <h5 translate>Who do you want to send the message to?</h5>

  <!-- SUGGESTED EMAILS -->
  @if (emails.length > 0) {
    <p-card>
      <ng-template pTemplate="header">
        @if (emails.length < 2) {
          {{ 'Suggested email address' | translate }}
        } @else {
          {{ 'Suggested email addresses' | translate }}
        }
        <small class="ml-1">(<span class="font-italic" translate>Drag and drop</span>)</small>
      </ng-template>
      <ul class="list-inline mb-1">
        @for (email of emails; track email) {
          <li class="list-inline-item mt-2">
            <p-tag pDraggable="emails" (onDragStart)="dragStart(email)" (onDragEnd)="dragEnd()" icon="pi pi-user" [value]="email"></p-tag>
          </li>
        }
      </ul>
    </p-card>
  }

  <!-- RECIPIENTS -->
  <p-card styleClass="mt-2" [header]="'Recipients' | translate">
    <div class="grid">
      @for (type of emailTypes; track type) {
        <div class="col-2 pt-3 label-title mb-2" [class.field-required]="mandatoryEmailTypes.includes(type)">
          {{ ('email_' + type) | translate }}
        </div>
        <div class="col-10 mb-2 drop-column">
          <p-chips class="p-fluid" [inputId]="type" pDroppable="emails" (onDrop)="drop($event)" [(ngModel)]="recipients[type]" [addOnBlur]="true"></p-chips>
        </div>
      }
    </div>
  </p-card>

  <!-- PREVIEW BOTTOM -->
  @if (previewPosition === 'bottom') {
    <h5 translate>Message</h5>
    <ng-content select="[previewBottomMessage]"></ng-content>
    <pre [innerHTML]="preview.trim() | nl2br"></pre>
  }
</div>
<div class="flex justify-content-end mt-4">
  <p-button class="mr-1" severity="danger" [outlined]="true" [label]="'Cancel'|translate" (onClick)="close()" aria-label="Close"/>
  <p-button [label]="'Confirm'|translate" [disabled]="!formValid()" (onClick)="confirm()" />
</div>
