<!--
  RERO ILS UI
  Copyright (C) 2021 RERO
  Copyright (C) 2021 UCLouvain

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<div class="modal-header">
  <h4 class="modal-title pull-left" translate>Send the order</h4>
  <button type="button" class="btn-close close pull-right" (click)="modalRef?.hide()" aria-label="Close">
    <span aria-hidden="true" class="visually-hidden">&times;</span>
  </button>
</div>
<div class="modal-body" *ngIf="preview; else loading">
  <p>
    {{ 'You\'re about to send the order.' | translate }}<br/>
    {{ 'Below you can find the preview message that will be sent.' | translate }}
  </p>
  <pre [innerHTML]="preview.content | nl2br"></pre>
  <h5 translate>Who do you want to send the message to?</h5>

  <dl class="container row">
    <!-- SEND TO VENDOR -->
    <dt class="col-1 text-right">
      <input type="radio" name="sentTo" (click)="sentTo('vendor', preview.data.vendor.email)"/>
    </dt>
    <dd class="col-4 label" translate>Send to the vendor</dd>
    <dd class="col-7 email" [class.selected]="recipientAddress === preview.data.vendor.email">
      ({{ preview.data.vendor.email }})
    </dd>
    <dd class="offset-1 col-11 small text-muted description" translate>
      Message will be sent directly to the vendor email box. No modification is possible.
    </dd>
    <!-- SEND TO LIBRARY -->
    <dt class="col-1 text-right">
      <input type="radio" name="sentTo" (click)="sentTo('library', preview.data.library.shipping_informations.email)"/>
    </dt>
    <dd class="col-4 label" translate>Send to library</dd>
    <dd class="col-7 email" [class.selected]="recipientAddress === preview.data.library.shipping_informations.email">
      ({{ preview.data.library.shipping_informations.email }})
    </dd>
    <dd class="offset-1 col-11 small text-muted description" translate>
      Message will be sent to the library shipping manager. The message could be updated and transferred to vendor.
    </dd>
    <!-- SEND TO CUSTOM EMAIL ADDRESS -->
    <dt class="col-1 text-right">
      <input type="radio" name="sentTo" (click)="sentTo('custom', customRecipient.value)"/>
    </dt>
    <dd class="col-4 label" translate>Send to custom address</dd>
    <dd class="col-7 text-right input-group">
      <input #customRecipient type="text" size="40"
             class="form-control"
             [ngClass]="{'is-invalid': recipientAddress && !isRecipientValid}"
             [disabled]="!customRecipientEnabled"
             (change)="recipientAddress = customRecipient.value"/>
      <div *ngIf="recipientAddress && !isRecipientValid" class="invalid-feedback" translate>Invalid email address.</div>
    </dd>
    <dd class="offset-1 col-11 small text-muted description" translate>
      Message will be sent to the email address you entered.
    </dd>
  </dl>
</div>
<div class="modal-footer">
  <button class="btn btn-outline-danger btn-sm" (click)="modalRef?.hide()" aria-label="Close">
    <i class="fa fa-times"></i>
    {{ 'Cancel' | translate }}
  </button>
  <button class="btn btn-primary btn-sm" aria-label="Confirm"
          [disabled]="!isRecipientValid || confirmInProgress"
          (click)="confirmOrder()"
  >
    <i class="fa" [ngClass]="{
      'fa-check': !confirmInProgress,
      'fa-spinner fa-pulse': confirmInProgress
    }"></i>
    {{ 'Confirm' | translate }}
  </button>
</div>

<ng-template #loading>
  <div class="modal-body py-5 text-center">
    <i class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>
    <span class="sr-only">Loading...</span>
  </div>
</ng-template>

