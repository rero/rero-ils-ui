<!--
  RERO ILS UI
  Copyright (C) 2021-2024 RERO
  Copyright (C) 2021-2023 UCLouvain

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
  @if (orderLine && account) {
    <div class="grid grid-cols-12 gap-4 mt-2 border-t border-b border-surface rounded-md">
      <div class="col-span-8 flex gap-4 py-2 pl-2 border-l border-surface">
        <shared-open-close-button (status)="isCollapsed = $event" />
        <i class="fa status"
            title="{{ orderLine.status | translate }}"
            [ngClass]="{
          'fa-envelope-open-o': orderLine.status === orderLineStatus.APPROVED,
          'fa-envelope-o': orderLine.status === orderLineStatus.ORDERED,
          'text-text-color-secondary': orderLine.status === orderLineStatus.APPROVED || orderLine.status === orderLineStatus.ORDERED,
          'fa-sign-in': orderLine.status === orderLineStatus.RECEIVED || orderLine.status === orderLineStatus.PARTIALLY_RECEIVED,
          'text-success': orderLine.status === orderLineStatus.RECEIVED,
          'text-warning': orderLine.status === orderLineStatus.PARTIALLY_RECEIVED,
          'fa-window-close-o text-error': orderLine.status === orderLineStatus.CANCELLED
        }"></i>
        <div class="flex items-start flex-col w-full">
          <div class="flex w-full justify-between">
            <div class="flex">
              @if (orderLine.document.pid | getRecord: 'documents' | async; as document) {
                <shared-document-brief-view [record]="$any(document).metadata" />
              }
            </div>
            @if (orderLine.notes.length > 0) {
              <div class="flex gap-1">
                @for (note of orderLine.notes; track note) {
                  <i class="fa fa-circle fa-bullet text-{{ note | noteBadgeColor }}" title="{{ note.type | translate }}"></i>
                }
              </div>
            }
          </div>
          <div [hidden]="!isCollapsed">{{ account.metadata.number }}</div>
          <div class="mt-2" [hidden]="isCollapsed">
            <dl class="metadata">
              <dt translate>Account</dt>
              <dd>
                {{ account.metadata.name }}
                <span>{{ account.metadata.number }}</span>
              </dd>
              <dt translate>Status</dt>
              <dd>{{ orderLine.status | translate }}</dd>
              @if (orderLine.priority > 0) {
                <dt translate>priority</dt>
                <dd>{{ orderLine.priority }}</dd>
              }
            </dl>

            <admin-notes [notes]="orderLine.notes" />
          </div>
        </div>
      </div>
      <div class="col-span-2 flex items-end gap-2 flex-col border-x border-surface py-2 px-2">
        <div class="text-xl font-bold">{{ orderLine.total_amount | currency:order.currency:'symbol' }}</div>
        <div class="text-muted-color text-sm">
          {{ orderLine.quantity}} x {{ orderLine.amount | currency:order.currency:'symbol' }}
          @if (orderLine.discount_amount > 0) {
            - {{ orderLine.discount_amount | currency:order.currency:'symbol' }}
          }
        </div>
      </div>
      <div class="col-span-2 flex gap-1 justify-end py-2 pr-2 border-r border-surface">
        @if (recordPermissions?.update?.can) {
          <shared-action-button
            icon="fa fa-pencil"
            [title]="'Edit'|translate"
            [routerLink]="['/acquisition', 'records', 'acq_order_lines', 'edit', orderLine.pid]"
          />
        }
        @if (recordPermissions) {
          <shared-action-button
            icon="fa fa-trash"
            [title]="'Delete'|translate"
            severity="danger"
            [disabled]="!recordPermissions.delete.can"
            [message]="deleteInfoMessage"
            (btnClick)="deleteOrderLine()"
          />
        }
      </div>
    </div>
  } @else {
    <div class="my-3">
      <i class="fa fa-spinner animate-spin"></i>&nbsp;{{ "Loading in progressâ€¦" | translate }}
    </div>
  }
